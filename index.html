<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MLBサウンドボックス</title>
<meta property="og:title" content="MLBサウンドボックス" />
<meta property="og:description" content="試合を盛り上げるBGMをワンタップ再生" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://raitakeda.github.io/usa-bgm-pad/" />
<meta property="og:image" content="https://raitakeda.github.io/usa-bgm-pad/samune.png" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:site_name" content="MLBサウンドボックス" />

<!-- Twitter(X)向け（任意だけど入れるの推奨） -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="MLBサウンドボックス" />
<meta name="twitter:description" content="試合を盛り上げるBGMをワンタップ再生" />
<meta name="twitter:image" content="https://raitakeda.github.io/usa-bgm-pad/samune.png" />
<link rel="icon" href="data:," />

<style>
:root{
  --bg:#0b0f14;
  --panel:#121a24;
  --panel2:#0f1620;
  --text:#eaf1ff;
  --muted:#9fb0c7;
  --accent:#2dd4bf;
  --danger:#fb7185;
  --btn:#1b2736;
  --btnActive:#20344a;
  --radius:16px;
  --gap:10px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  font-family: system-ui, -apple-system, "Noto Sans JP", Meiryo, sans-serif;
  background: radial-gradient(1200px 800px at 50% -10%, #18304a 0%, var(--bg) 55%);
  color:var(--text);
}
.wrap{
  max-width:520px;
  margin:0 auto;
  padding:12px;
}
h1{margin:0;font-size:18px;}
.hint{font-size:12px;color:var(--muted);}

.section{
  background:linear-gradient(180deg,var(--panel),var(--panel2));
  border-radius:var(--radius);
  padding:12px;
  margin-bottom:12px;
}
.section-title{
  font-size:12px;
  color:var(--muted);
  margin-bottom:8px;
}

.grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:var(--gap);}
.grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--gap);}
.row-single{margin-top:var(--gap);}

button{
  border:none;
  border-radius:14px;
  background:var(--btn);
  color:var(--text);
  font-size:15px;
  font-weight:600;
  padding:14px 8px;
  min-height:56px;
  box-shadow:0 6px 14px rgba(0,0,0,.2);
}
button:active{transform:translateY(1px);}
button.playing{
  background:var(--btnActive);
  outline:2px solid var(--accent);
}
button.stop{
  background:#5b1d2a;
}

.footer{
  display:grid;
  grid-template-columns:1fr 1.6fr;
  gap:var(--gap);
}
.now{
  background:rgba(255,255,255,.05);
  border-radius:14px;
  padding:10px;
  display:flex;
  flex-direction:column;
  justify-content:center;
}
.now .label{font-size:11px;color:var(--muted);}
.now .title{
  font-size:14px;
  font-weight:700;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>MLBサウンドボックス</h1>
  <p class="hint">停止はフェードアウト</p>

  <section class="section">
    <div class="section-title">ORGAN</div>
    <div class="grid-3" id="o1"></div>
    <div class="grid-3" id="o2"></div>
    <div class="grid-3" id="o3"></div>
    <div class="grid-3" id="o4"></div>
    <div class="row-single" id="o5"></div>
  </section>

  <section class="section">
    <div class="section-title">MUSIC</div>
    <div class="grid-2" id="music"></div>
  </section>

  <div class="footer">
    <button class="stop" id="stopBtn">停止</button>
    <div class="now">
      <div class="label">再生中</div>
      <div class="title" id="nowPlaying">（なし）</div>
    </div>
  </div>
</div>

<script>
const AUDIO_BASE = "audio/";
const audio = new Audio();
audio.volume = 1.0;
// --- iOS Safari対策：Web Audioでフェードさせる ---
let audioCtx = null;
let gainNode = null;
let sourceNode = null;

function ensureAudioGraph(){
  if (!audioCtx){
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    gainNode = audioCtx.createGain();
    gainNode.gain.value = 1.0;
    gainNode.connect(audioCtx.destination);
  }

  // iOSはユーザー操作後でもsuspendedが残ることがある
  if (audioCtx.state === "suspended"){
    audioCtx.resume();
  }

  // MediaElementSourceは同じaudio要素に対して1回だけ作る制約があるので注意
  // → 既に作ってあるなら再作成しない
  if (!sourceNode){
    sourceNode = audioCtx.createMediaElementSource(audio);
    sourceNode.connect(gainNode);
  }
}


let fadeTimer = null;

const tracksOrgan = [
 {k:"01",b:"Charge",f:"01-Charge.wav"},
 {k:"02",b:"HereWeGo",f:"02-HereWeGo.wav"},
 {k:"03",b:"O’Malley",f:"03-O’Malley Steps.wav"},
 {k:"04",b:"Gypsy",f:"04-Gypsy Spain.wav"},
 {k:"05",b:"Rally",f:"05-Rally Time.wav"},
 {k:"06",b:"Go Team Go!",f:"06-Go Team Go!.wav"},
 {k:"07",b:"Zorba",f:"07-Zorba the Greek.wav"},
 {k:"08",b:"Claps",f:"08-Let's Go Claps.wav"},
 {k:"09",b:"Rhapsody",f:"09-Lizt's Hungarian Rhapsody No. 2.wav"},
 {k:"10",b:"Nagila",f:"10-Hava Nagila.wav"},
 {k:"11",b:"Chiapanecas",f:"11-Las Chiapanecas.wav"},
 {k:"12",b:"Impro",f:"12-Improvisations_Endtags.wav"},
 {k:"13",b:"Ballgame",f:"13-TakeMeOutToTheBallgame.wav"},
];

const tracksMusic = [
 {k:"A",b:"大谷",f:"Shohei Ohtani Walk Up Song 2025.mp3"},
 {k:"B",b:"山本",f:"Yoshinobu Yamamoto Warm Up Song 2025.mp3"},
];

function clearFade(){
  if(fadeTimer){clearInterval(fadeTimer);fadeTimer=null;}
}

function play(track){
  clearFade();
    // iOS Safari対策
  ensureAudioGraph();

  // もしフェード中に別曲押されたら、音量を即復帰
  const now = audioCtx.currentTime;
  gainNode.gain.cancelScheduledValues(now);
  gainNode.gain.setValueAtTime(1.0, now);
  
  audio.pause();
  audio.currentTime=0;
  audio.src=AUDIO_BASE+track.f;
  //audio.volume = 1.0;
  audio.play();
  document.getElementById("nowPlaying").textContent=track.b;
  document.querySelectorAll("button[data-k]").forEach(b=>{
    b.classList.toggle("playing", b.dataset.k===track.k);
  });
}

function stopFade(){
  if (audio.paused) return;

  // フェード中タイマー（旧方式）が残っていたら止める
  if (fadeTimer){
    clearInterval(fadeTimer);
    fadeTimer = null;
  }

  // iOS Safari対策
  ensureAudioGraph();

  const durationMs = 2000;          // ←ここを変えると秒数が変わる
  const durationSec = durationMs / 1000;
  const now = audioCtx.currentTime;

  // 現在のゲイン値から滑らかに0へ
  gainNode.gain.cancelScheduledValues(now);

  // cancel後の値がズレることがあるので、念のため現在値をセット
  gainNode.gain.setValueAtTime(gainNode.gain.value, now);
  gainNode.gain.linearRampToValueAtTime(0.0, now + durationSec);

  // フェード完了後に停止＋ゲイン復帰
  setTimeout(() => {
    audio.pause();
    audio.currentTime = 0;

    const t = audioCtx.currentTime;
    gainNode.gain.cancelScheduledValues(t);
    gainNode.gain.setValueAtTime(1.0, t);

    document.getElementById("nowPlaying").textContent = "（なし）";
    document.querySelectorAll(".playing").forEach(b => b.classList.remove("playing"));
  }, durationMs);
}


document.getElementById("stopBtn").onclick=stopFade;

function makeBtn(t){
  const b=document.createElement("button");
  b.textContent=t.b;
  b.dataset.k=t.k;
  b.onclick=()=>play(t);
  return b;
}

tracksOrgan.slice(0,3).forEach(t=>o1.appendChild(makeBtn(t)));
tracksOrgan.slice(3,6).forEach(t=>o2.appendChild(makeBtn(t)));
tracksOrgan.slice(6,9).forEach(t=>o3.appendChild(makeBtn(t)));
tracksOrgan.slice(9,12).forEach(t=>o4.appendChild(makeBtn(t)));
tracksOrgan.slice(12).forEach(t=>o5.appendChild(makeBtn(t)));
tracksMusic.forEach(t=>music.appendChild(makeBtn(t)));
</script>
</body>
</html>





